<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EDI ë¶„ì„">
    <title>EDI ë°œì£¼ ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Malgun Gothic', -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; overscroll-behavior: none; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .install-banner { position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(135deg, #1e40af, #3b82f6); color: white; padding: 16px; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 -4px 20px rgba(0,0,0,0.15); }
        .install-banner.hidden { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <div id="installBanner" class="install-banner hidden">
        <div>
            <strong>ğŸ“± ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ê¸°</strong>
            <p style="margin:4px 0 0; font-size:12px; opacity:0.9;">í™ˆ í™”ë©´ì— ì¶”ê°€í•˜ì—¬ ë” ë¹ ë¥´ê²Œ ì‚¬ìš©í•˜ì„¸ìš”</p>
        </div>
        <div style="display:flex; gap:8px;">
            <button onclick="dismissInstall()" style="padding:8px 16px; background:transparent; border:1px solid white; color:white; border-radius:8px; cursor:pointer;">ë‚˜ì¤‘ì—</button>
            <button onclick="installApp()" style="padding:8px 16px; background:white; color:#1e40af; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">ì„¤ì¹˜</button>
        </div>
    </div>

    <script>
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; document.getElementById('installBanner').classList.remove('hidden'); });
        function installApp() { if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then((result) => { deferredPrompt = null; document.getElementById('installBanner').classList.add('hidden'); }); } }
        function dismissInstall() { document.getElementById('installBanner').classList.add('hidden'); }
        window.addEventListener('appinstalled', () => { document.getElementById('installBanner').classList.add('hidden'); });
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js').catch(err => console.log('SW ë“±ë¡ ì‹¤íŒ¨:', err)); }
    </script>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        function EDIDashboard() {
            const [data, setData] = useState([]);
            const [filters, setFilters] = useState({ 
                ì‹œì‘ì›”: '', 
                ì¢…ë£Œì›”: '', 
                ì§€ì—­: '', 
                ê³ ê°ì‚¬: '', 
                ì°¨ì¢…: '', 
                í’ˆë²ˆ: '', 
                í’ˆëª…: '' 
            });
            const [isLoading, setIsLoading] = useState(false);
            const [uploadStatus, setUploadStatus] = useState(null);
            const [activeTab, setActiveTab] = useState('analysis');
            const [recentFiles, setRecentFiles] = useState([]);
            const [savedPath, setSavedPath] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [showFilters, setShowFilters] = useState(true);

            useEffect(() => {
                const saved = localStorage.getItem('edi-recent-files');
                if (saved) setRecentFiles(JSON.parse(saved));
                const path = localStorage.getItem('edi-saved-path');
                if (path) setSavedPath(path);
            }, []);

            const saveRecentFile = (fileName, recordCount) => {
                const newFile = { name: fileName, date: new Date().toLocaleString('ko-KR'), count: recordCount };
                const updated = [newFile, ...recentFiles.filter(f => f.name !== fileName)].slice(0, 5);
                setRecentFiles(updated);
                localStorage.setItem('edi-recent-files', JSON.stringify(updated));
            };

            const saveDefaultPath = (path) => {
                setSavedPath(path);
                localStorage.setItem('edi-saved-path', path);
            };

            // ìƒ˜í”Œ ë°ì´í„° (ì°¨ì¢… ì¶”ê°€)
            const sampleData = [
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Bowling Green', ì°¨ì¢…: '1095', í’ˆë²ˆ: '1101-500028', í’ˆëª…: 'CHMSL / 1095', ë¶„ì„ì›”: '2025-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 1800, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 1850, ë³€ë™ìœ¨: 2.78, ì¶œê³ ìœ¨: 102.78 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Bowling Green', ì°¨ì¢…: '1095', í’ˆë²ˆ: '1101-500028', í’ˆëª…: 'CHMSL / 1095', ë¶„ì„ì›”: '2025-06', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 2200, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2180, ë³€ë™ìœ¨: -0.91, ì¶œê³ ìœ¨: 99.09 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Bowling Green', ì°¨ì¢…: '1095', í’ˆë²ˆ: '1101-500028', í’ˆëª…: 'CHMSL / 1095', ë¶„ì„ì›”: '2025-12', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 1950, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2000, ë³€ë™ìœ¨: 2.56, ì¶œê³ ìœ¨: 102.56 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Bowling Green', ì°¨ì¢…: '1095', í’ˆë²ˆ: '1101-500028', í’ˆëª…: 'CHMSL / 1095', ë¶„ì„ì›”: '2026-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 2016, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2100, ë³€ë™ìœ¨: 4.17, ì¶œê³ ìœ¨: 104.17 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Bowling Green', ì°¨ì¢…: '1095', í’ˆë²ˆ: '1101-500028', í’ˆëª…: 'CHMSL / 1095', ë¶„ì„ì›”: '2026-02', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 2100, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2150, ë³€ë™ìœ¨: 2.38, ì¶œê³ ìœ¨: 102.38 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Flint', ì°¨ì¢…: 'XT6', í’ˆë²ˆ: '1311-000003', í’ˆëª…: 'LAMP ASSY-FENDER CL,FRT', ë¶„ì„ì›”: '2025-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 1200, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 1400, ë³€ë™ìœ¨: 16.67, ì¶œê³ ìœ¨: 116.67 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Flint', ì°¨ì¢…: 'XT6', í’ˆë²ˆ: '1311-000003', í’ˆëª…: 'LAMP ASSY-FENDER CL,FRT', ë¶„ì„ì›”: '2025-06', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 1500, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2000, ë³€ë™ìœ¨: 33.33, ì¶œê³ ìœ¨: 133.33 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Flint', ì°¨ì¢…: 'XT6', í’ˆë²ˆ: '1311-000003', í’ˆëª…: 'LAMP ASSY-FENDER CL,FRT', ë¶„ì„ì›”: '2025-12', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 1700, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2800, ë³€ë™ìœ¨: 64.71, ì¶œê³ ìœ¨: 164.71 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Flint', ì°¨ì¢…: 'XT6', í’ˆë²ˆ: '1311-000003', í’ˆëª…: 'LAMP ASSY-FENDER CL,FRT', ë¶„ì„ì›”: '2026-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 1728, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 3200, ë³€ë™ìœ¨: 85.19, ì¶œê³ ìœ¨: 185.19 },
                { ì§€ì—­: 'US', ê³ ê°ì‚¬: 'GM Flint', ì°¨ì¢…: 'XT6', í’ˆë²ˆ: '1311-000003', í’ˆëª…: 'LAMP ASSY-FENDER CL,FRT', ë¶„ì„ì›”: '2026-02', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 2000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 3456, ë³€ë™ìœ¨: 72.8, ì¶œê³ ìœ¨: 172.8 },
                { ì§€ì—­: 'MX', ê³ ê°ì‚¬: 'GM Ramos', ì°¨ì¢…: 'LD', í’ˆë²ˆ: '1111-500310', í’ˆëª…: 'LD Box Delete Taillamp, RH', ë¶„ì„ì›”: '2025-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 4000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 5500, ë³€ë™ìœ¨: 37.5, ì¶œê³ ìœ¨: 137.5 },
                { ì§€ì—­: 'MX', ê³ ê°ì‚¬: 'GM Ramos', ì°¨ì¢…: 'LD', í’ˆë²ˆ: '1111-500310', í’ˆëª…: 'LD Box Delete Taillamp, RH', ë¶„ì„ì›”: '2025-06', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 5000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 7200, ë³€ë™ìœ¨: 44, ì¶œê³ ìœ¨: 144 },
                { ì§€ì—­: 'MX', ê³ ê°ì‚¬: 'GM Ramos', ì°¨ì¢…: 'LD', í’ˆë²ˆ: '1111-500310', í’ˆëª…: 'LD Box Delete Taillamp, RH', ë¶„ì„ì›”: '2025-12', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 5200, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 8000, ë³€ë™ìœ¨: 53.85, ì¶œê³ ìœ¨: 153.85 },
                { ì§€ì—­: 'MX', ê³ ê°ì‚¬: 'GM Ramos', ì°¨ì¢…: 'LD', í’ˆë²ˆ: '1111-500310', í’ˆëª…: 'LD Box Delete Taillamp, RH', ë¶„ì„ì›”: '2026-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 5184, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 9500, ë³€ë™ìœ¨: 83.26, ì¶œê³ ìœ¨: 183.26 },
                { ì§€ì—­: 'MX', ê³ ê°ì‚¬: 'GM Ramos', ì°¨ì¢…: 'LD', í’ˆë²ˆ: '1111-500310', í’ˆëª…: 'LD Box Delete Taillamp, RH', ë¶„ì„ì›”: '2026-02', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 6000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 8640, ë³€ë™ìœ¨: 44, ì¶œê³ ìœ¨: 144 },
                { ì§€ì—­: 'CA', ê³ ê°ì‚¬: 'Plasman Canada', ì°¨ì¢…: 'BT1', í’ˆë²ˆ: '1101-500035', í’ˆëª…: 'LAMP ASSY - CHMSL', ë¶„ì„ì›”: '2025-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 32000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 31000, ë³€ë™ìœ¨: -3.13, ì¶œê³ ìœ¨: 96.88 },
                { ì§€ì—­: 'CA', ê³ ê°ì‚¬: 'Plasman Canada', ì°¨ì¢…: 'BT1', í’ˆë²ˆ: '1101-500035', í’ˆëª…: 'LAMP ASSY - CHMSL', ë¶„ì„ì›”: '2025-06', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 30000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 28000, ë³€ë™ìœ¨: -6.67, ì¶œê³ ìœ¨: 93.33 },
                { ì§€ì—­: 'CA', ê³ ê°ì‚¬: 'Plasman Canada', ì°¨ì¢…: 'BT1', í’ˆë²ˆ: '1101-500035', í’ˆëª…: 'LAMP ASSY - CHMSL', ë¶„ì„ì›”: '2025-12', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 28000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 25000, ë³€ë™ìœ¨: -10.71, ì¶œê³ ìœ¨: 89.29 },
                { ì§€ì—­: 'CA', ê³ ê°ì‚¬: 'Plasman Canada', ì°¨ì¢…: 'BT1', í’ˆë²ˆ: '1101-500035', í’ˆëª…: 'LAMP ASSY - CHMSL', ë¶„ì„ì›”: '2026-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 28800, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 24000, ë³€ë™ìœ¨: -16.67, ì¶œê³ ìœ¨: 83.33 },
                { ì§€ì—­: 'CA', ê³ ê°ì‚¬: 'Plasman Canada', ì°¨ì¢…: 'BT1', í’ˆë²ˆ: '1101-500035', í’ˆëª…: 'LAMP ASSY - CHMSL', ë¶„ì„ì›”: '2026-02', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 25800, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 22000, ë³€ë™ìœ¨: -14.73, ì¶œê³ ìœ¨: 85.27 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', ì°¨ì¢…: 'NX4', í’ˆë²ˆ: '1411-000001', í’ˆëª…: 'HEAD LAMP ASSY LH', ë¶„ì„ì›”: '2025-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 4000, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 4100, ë³€ë™ìœ¨: 2.5, ì¶œê³ ìœ¨: 102.5 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', ì°¨ì¢…: 'NX4', í’ˆë²ˆ: '1411-000001', í’ˆëª…: 'HEAD LAMP ASSY LH', ë¶„ì„ì›”: '2025-06', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 4200, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 4400, ë³€ë™ìœ¨: 4.76, ì¶œê³ ìœ¨: 104.76 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', ì°¨ì¢…: 'NX4', í’ˆë²ˆ: '1411-000001', í’ˆëª…: 'HEAD LAMP ASSY LH', ë¶„ì„ì›”: '2025-12', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 4400, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 4600, ë³€ë™ìœ¨: 4.55, ì¶œê³ ìœ¨: 104.55 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', ì°¨ì¢…: 'NX4', í’ˆë²ˆ: '1411-000001', í’ˆëª…: 'HEAD LAMP ASSY LH', ë¶„ì„ì›”: '2026-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 4500, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 4725, ë³€ë™ìœ¨: 5, ì¶œê³ ìœ¨: 105 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', ì°¨ì¢…: 'NX4', í’ˆë²ˆ: '1411-000001', í’ˆëª…: 'HEAD LAMP ASSY LH', ë¶„ì„ì›”: '2026-02', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 4800, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 5040, ë³€ë™ìœ¨: 5, ì¶œê³ ìœ¨: 105 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'SL Corporation', ì°¨ì¢…: 'MU', í’ˆë²ˆ: '1511-000001', í’ˆëª…: 'TAIL LAMP ASSY LH', ë¶„ì„ì›”: '2025-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 3500, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 1200, ë³€ë™ìœ¨: -65.71, ì¶œê³ ìœ¨: 34.29 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'SL Corporation', ì°¨ì¢…: 'MU', í’ˆë²ˆ: '1511-000001', í’ˆëª…: 'TAIL LAMP ASSY LH', ë¶„ì„ì›”: '2025-06', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 3400, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 1800, ë³€ë™ìœ¨: -47.06, ì¶œê³ ìœ¨: 52.94 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'SL Corporation', ì°¨ì¢…: 'MU', í’ˆë²ˆ: '1511-000001', í’ˆëª…: 'TAIL LAMP ASSY LH', ë¶„ì„ì›”: '2025-12', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 3200, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2600, ë³€ë™ìœ¨: -18.75, ì¶œê³ ìœ¨: 81.25 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'SL Corporation', ì°¨ì¢…: 'MU', í’ˆë²ˆ: '1511-000001', í’ˆëª…: 'TAIL LAMP ASSY LH', ë¶„ì„ì›”: '2026-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 3200, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 2900, ë³€ë™ìœ¨: -9.38, ì¶œê³ ìœ¨: 90.63 },
                { ì§€ì—­: 'KR', ê³ ê°ì‚¬: 'SL Corporation', ì°¨ì¢…: 'MU', í’ˆë²ˆ: '1511-000001', í’ˆëª…: 'TAIL LAMP ASSY LH', ë¶„ì„ì›”: '2026-02', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 3200, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 3100, ë³€ë™ìœ¨: -3.13, ì¶œê³ ìœ¨: 96.88 },
                { ì§€ì—­: 'CA', ê³ ê°ì‚¬: 'Metelix', ì°¨ì¢…: 'BT1FG', í’ˆë²ˆ: '1351-000004', í’ˆëª…: 'BT1FG LAMP RR ID 26MY', ë¶„ì„ì›”: '2026-01', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 144, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 144, ë³€ë™ìœ¨: 0, ì¶œê³ ìœ¨: 100 },
                { ì§€ì—­: 'CA', ê³ ê°ì‚¬: 'Metelix', ì°¨ì¢…: 'BT1FG', í’ˆë²ˆ: '1351-000004', í’ˆëª…: 'BT1FG LAMP RR ID 26MY', ë¶„ì„ì›”: '2026-02', ê³„íšë°œì£¼ìˆ˜ëŸ‰: 150, ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: 155, ë³€ë™ìœ¨: 3.33, ì¶œê³ ìœ¨: 103.33 },
            ];

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsLoading(true);
                try {
                    const buffer = await file.arrayBuffer();
                    const workbook = XLSX.read(buffer, { type: 'array' });
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const rawData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                    const parsedData = [];
                    for (let i = 2; i < rawData.length; i++) {
                        const row = rawData[i];
                        if (!row[0] || !row[5]) continue;
                        // 1ì›” ë°ì´í„°
                        const jan_plan = [row[9], row[10], row[11], row[12]].reduce((s, v) => s + (Number(v) || 0), 0);
                        const jan_actual = [row[13], row[14], row[15], row[16]].reduce((s, v) => s + (Number(v) || 0), 0);
                        parsedData.push({ 
                            ì§€ì—­: row[0], 
                            ê³ ê°ì‚¬: row[2], 
                            ì°¨ì¢…: row[3] || '', 
                            í’ˆë²ˆ: row[5], 
                            í’ˆëª…: row[6], 
                            ë¶„ì„ì›”: '2026-01', 
                            ê³„íšë°œì£¼ìˆ˜ëŸ‰: jan_plan, 
                            ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: jan_actual, 
                            ë³€ë™ìœ¨: jan_plan ? Math.round(((jan_actual - jan_plan) / jan_plan) * 10000) / 100 : null, 
                            ì¶œê³ ìœ¨: jan_plan ? Math.round((jan_actual / jan_plan) * 10000) / 100 : null 
                        });
                        // 2ì›” ë°ì´í„°
                        const feb_plan = [row[30], row[31], row[32], row[33]].reduce((s, v) => s + (Number(v) || 0), 0);
                        const feb_actual = [row[34], row[35], row[36], row[37]].reduce((s, v) => s + (Number(v) || 0), 0);
                        parsedData.push({ 
                            ì§€ì—­: row[0], 
                            ê³ ê°ì‚¬: row[2], 
                            ì°¨ì¢…: row[3] || '', 
                            í’ˆë²ˆ: row[5], 
                            í’ˆëª…: row[6], 
                            ë¶„ì„ì›”: '2026-02', 
                            ê³„íšë°œì£¼ìˆ˜ëŸ‰: feb_plan, 
                            ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰: feb_actual, 
                            ë³€ë™ìœ¨: feb_plan ? Math.round(((feb_actual - feb_plan) / feb_plan) * 10000) / 100 : null, 
                            ì¶œê³ ìœ¨: feb_plan ? Math.round((feb_actual / feb_plan) * 10000) / 100 : null 
                        });
                    }
                    setData(parsedData);
                    setUploadStatus({ type: 'success', message: `${parsedData.length}ê±´` });
                    resetFilters();
                    saveRecentFile(file.name, parsedData.length);
                } catch (err) {
                    setUploadStatus({ type: 'error', message: 'ì˜¤ë¥˜: ' + err.message });
                }
                setIsLoading(false);
            };

            const loadSample = () => {
                setData(sampleData);
                setUploadStatus({ type: 'success', message: `${sampleData.length}ê±´ ë¡œë“œ` });
                resetFilters();
            };

            const resetFilters = () => {
                setFilters({ ì‹œì‘ì›”: '', ì¢…ë£Œì›”: '', ì§€ì—­: '', ê³ ê°ì‚¬: '', ì°¨ì¢…: '', í’ˆë²ˆ: '', í’ˆëª…: '' });
            };

            // ê¸°ê°„ ì˜µì…˜ (ì „ì²´ ë°ì´í„° ê¸°ì¤€)
            const ì›”Options = useMemo(() => [...new Set(data.map(d => d.ë¶„ì„ì›”))].filter(Boolean).sort(), [data]);

            // ========== ê³„ë‹¨ì‹ í•„í„° ì˜µì…˜ ==========
            // 1ë‹¨ê³„: ê¸°ê°„ í•„í„° ì ìš©ëœ ë°ì´í„°
            const periodFilteredData = useMemo(() => {
                let result = data;
                if (filters.ì‹œì‘ì›”) result = result.filter(d => d.ë¶„ì„ì›” >= filters.ì‹œì‘ì›”);
                if (filters.ì¢…ë£Œì›”) result = result.filter(d => d.ë¶„ì„ì›” <= filters.ì¢…ë£Œì›”);
                return result;
            }, [data, filters.ì‹œì‘ì›”, filters.ì¢…ë£Œì›”]);

            // 2ë‹¨ê³„: ì§€ì—­ ì˜µì…˜ (ê¸°ê°„ í•„í„°ë§Œ ì ìš©)
            const ì§€ì—­Options = useMemo(() => 
                [...new Set(periodFilteredData.map(d => d.ì§€ì—­))].filter(Boolean).sort()
            , [periodFilteredData]);

            // 3ë‹¨ê³„: ê³ ê°ì‚¬ ì˜µì…˜ (ê¸°ê°„ + ì§€ì—­)
            const ê³ ê°ì‚¬Options = useMemo(() => {
                let f = periodFilteredData;
                if (filters.ì§€ì—­) f = f.filter(d => d.ì§€ì—­ === filters.ì§€ì—­);
                return [...new Set(f.map(d => d.ê³ ê°ì‚¬))].filter(Boolean).sort();
            }, [periodFilteredData, filters.ì§€ì—­]);

            // 4ë‹¨ê³„: ì°¨ì¢… ì˜µì…˜ (ê¸°ê°„ + ì§€ì—­ + ê³ ê°ì‚¬)
            const ì°¨ì¢…Options = useMemo(() => {
                let f = periodFilteredData;
                if (filters.ì§€ì—­) f = f.filter(d => d.ì§€ì—­ === filters.ì§€ì—­);
                if (filters.ê³ ê°ì‚¬) f = f.filter(d => d.ê³ ê°ì‚¬ === filters.ê³ ê°ì‚¬);
                return [...new Set(f.map(d => d.ì°¨ì¢…))].filter(Boolean).sort();
            }, [periodFilteredData, filters.ì§€ì—­, filters.ê³ ê°ì‚¬]);

            // 5ë‹¨ê³„: í’ˆë²ˆ ì˜µì…˜ (ê¸°ê°„ + ì§€ì—­ + ê³ ê°ì‚¬ + ì°¨ì¢…)
            const í’ˆë²ˆOptions = useMemo(() => {
                let f = periodFilteredData;
                if (filters.ì§€ì—­) f = f.filter(d => d.ì§€ì—­ === filters.ì§€ì—­);
                if (filters.ê³ ê°ì‚¬) f = f.filter(d => d.ê³ ê°ì‚¬ === filters.ê³ ê°ì‚¬);
                if (filters.ì°¨ì¢…) f = f.filter(d => d.ì°¨ì¢… === filters.ì°¨ì¢…);
                return [...new Set(f.map(d => d.í’ˆë²ˆ))].filter(Boolean).sort();
            }, [periodFilteredData, filters.ì§€ì—­, filters.ê³ ê°ì‚¬, filters.ì°¨ì¢…]);

            // 6ë‹¨ê³„: í’ˆëª… ì˜µì…˜ (ê¸°ê°„ + ì§€ì—­ + ê³ ê°ì‚¬ + ì°¨ì¢… + í’ˆë²ˆ)
            const í’ˆëª…Options = useMemo(() => {
                let f = periodFilteredData;
                if (filters.ì§€ì—­) f = f.filter(d => d.ì§€ì—­ === filters.ì§€ì—­);
                if (filters.ê³ ê°ì‚¬) f = f.filter(d => d.ê³ ê°ì‚¬ === filters.ê³ ê°ì‚¬);
                if (filters.ì°¨ì¢…) f = f.filter(d => d.ì°¨ì¢… === filters.ì°¨ì¢…);
                if (filters.í’ˆë²ˆ) f = f.filter(d => d.í’ˆë²ˆ === filters.í’ˆë²ˆ);
                return [...new Set(f.map(d => d.í’ˆëª…))].filter(Boolean).sort();
            }, [periodFilteredData, filters.ì§€ì—­, filters.ê³ ê°ì‚¬, filters.ì°¨ì¢…, filters.í’ˆë²ˆ]);

            // ê³„ë‹¨ì‹ í•„í„° ë³€ê²½ í•¸ë“¤ëŸ¬
            const handleFilterChange = (key, value) => {
                const newFilters = { ...filters, [key]: value };
                
                // ê³„ë‹¨ì‹ ì´ˆê¸°í™”
                if (key === 'ì‹œì‘ì›”' || key === 'ì¢…ë£Œì›”') {
                    newFilters.ì§€ì—­ = ''; newFilters.ê³ ê°ì‚¬ = ''; newFilters.ì°¨ì¢… = ''; newFilters.í’ˆë²ˆ = ''; newFilters.í’ˆëª… = '';
                } else if (key === 'ì§€ì—­') {
                    newFilters.ê³ ê°ì‚¬ = ''; newFilters.ì°¨ì¢… = ''; newFilters.í’ˆë²ˆ = ''; newFilters.í’ˆëª… = '';
                } else if (key === 'ê³ ê°ì‚¬') {
                    newFilters.ì°¨ì¢… = ''; newFilters.í’ˆë²ˆ = ''; newFilters.í’ˆëª… = '';
                } else if (key === 'ì°¨ì¢…') {
                    newFilters.í’ˆë²ˆ = ''; newFilters.í’ˆëª… = '';
                } else if (key === 'í’ˆë²ˆ') {
                    newFilters.í’ˆëª… = '';
                }
                setFilters(newFilters);
            };

            // ìµœì¢… í•„í„°ë§ëœ ë°ì´í„°
            const filteredData = useMemo(() => {
                let result = periodFilteredData;
                if (filters.ì§€ì—­) result = result.filter(d => d.ì§€ì—­ === filters.ì§€ì—­);
                if (filters.ê³ ê°ì‚¬) result = result.filter(d => d.ê³ ê°ì‚¬ === filters.ê³ ê°ì‚¬);
                if (filters.ì°¨ì¢…) result = result.filter(d => d.ì°¨ì¢… === filters.ì°¨ì¢…);
                if (filters.í’ˆë²ˆ) result = result.filter(d => d.í’ˆë²ˆ === filters.í’ˆë²ˆ);
                if (filters.í’ˆëª…) result = result.filter(d => d.í’ˆëª… === filters.í’ˆëª…);
                return result;
            }, [periodFilteredData, filters]);

            // KPI ê³„ì‚°
            const kpis = useMemo(() => {
                if (filteredData.length === 0) return { plan: 0, actual: 0, avgVar: 0, avgRate: 0, issueCount: 0 };
                const plan = filteredData.reduce((s, d) => s + d.ê³„íšë°œì£¼ìˆ˜ëŸ‰, 0);
                const actual = filteredData.reduce((s, d) => s + d.ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰, 0);
                const validVar = filteredData.filter(d => d.ë³€ë™ìœ¨ !== null);
                const validRate = filteredData.filter(d => d.ì¶œê³ ìœ¨ !== null);
                const avgVar = validVar.length > 0 ? validVar.reduce((s, d) => s + d.ë³€ë™ìœ¨, 0) / validVar.length : 0;
                const avgRate = validRate.length > 0 ? validRate.reduce((s, d) => s + d.ì¶œê³ ìœ¨, 0) / validRate.length : 0;
                const issueCount = filteredData.filter(d => d.ì¶œê³ ìœ¨ !== null && d.ì¶œê³ ìœ¨ < 80).length;
                return { plan, actual, avgVar: Math.round(avgVar * 100) / 100, avgRate: Math.round(avgRate * 100) / 100, issueCount };
            }, [filteredData]);

            // AI ìˆ˜ëŸ‰ ì œì•ˆ
            const recommendations = useMemo(() => {
                const groups = {};
                filteredData.forEach(row => {
                    const key = `${row.ì§€ì—­}|${row.ê³ ê°ì‚¬}|${row.ì°¨ì¢…}|${row.í’ˆë²ˆ}`;
                    if (!groups[key]) groups[key] = { ...row, records: [] };
                    groups[key].records.push(row);
                });
                return Object.values(groups).map(g => {
                    const valid = g.records.filter(r => r.ì¶œê³ ìœ¨ !== null);
                    if (valid.length === 0) return null;
                    const avgRate = valid.reduce((s, r) => s + r.ì¶œê³ ìœ¨, 0) / valid.length;
                    const last = valid[valid.length - 1];
                    let ê¶Œì¥ = last.ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰;
                    if (avgRate >= 120) ê¶Œì¥ *= 1.1;
                    else if (avgRate < 80) ê¶Œì¥ *= 0.95;
                    const ì‹ ë¢°ë„ = valid.length === 1 ? 30 : valid.length <= 3 ? 50 : valid.length <= 6 ? 70 : 85;
                    return { ...g, í‰ê· ì¶œê³ ìœ¨: Math.round(avgRate), ê¶Œì¥ìˆ˜ëŸ‰: Math.round(ê¶Œì¥), ì‹ ë¢°ë„, ìœ„í—˜ë“±ê¸‰: avgRate < 80 ? 'ë†’ìŒ' : avgRate >= 120 ? 'ì£¼ì˜' : 'ë‚®ìŒ' };
                }).filter(Boolean);
            }, [filteredData]);

            const downloadExcel = () => {
                const ws = XLSX.utils.json_to_sheet(filteredData.map(d => ({
                    'ì§€ì—­': d.ì§€ì—­, 'ê³ ê°ì‚¬': d.ê³ ê°ì‚¬, 'ì°¨ì¢…': d.ì°¨ì¢…, 'í’ˆë²ˆ': d.í’ˆë²ˆ, 'í’ˆëª…': d.í’ˆëª…, 
                    'ë¶„ì„ì›”': d.ë¶„ì„ì›”, 'ê³„íšë°œì£¼ìˆ˜ëŸ‰': d.ê³„íšë°œì£¼ìˆ˜ëŸ‰, 'ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰': d.ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰, 
                    'ë³€ë™ìœ¨(%)': d.ë³€ë™ìœ¨, 'ì¶œê³ ìœ¨(%)': d.ì¶œê³ ìœ¨
                })));
                const ws2 = XLSX.utils.json_to_sheet(recommendations.map(r => ({
                    'ì§€ì—­': r.ì§€ì—­, 'ê³ ê°ì‚¬': r.ê³ ê°ì‚¬, 'ì°¨ì¢…': r.ì°¨ì¢…, 'í’ˆë²ˆ': r.í’ˆë²ˆ, 'í’ˆëª…': r.í’ˆëª…,
                    'í‰ê· ì¶œê³ ìœ¨(%)': r.í‰ê· ì¶œê³ ìœ¨, 'ê¶Œì¥ìˆ˜ëŸ‰': r.ê¶Œì¥ìˆ˜ëŸ‰, 'ì‹ ë¢°ë„(%)': r.ì‹ ë¢°ë„, 'ìœ„í—˜ë“±ê¸‰': r.ìœ„í—˜ë“±ê¸‰
                })));
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'ë°œì£¼ë¶„ì„');
                XLSX.utils.book_append_sheet(wb, ws2, 'ìˆ˜ëŸ‰ì œì•ˆ');
                XLSX.writeFile(wb, `EDI_ë°œì£¼ë¶„ì„_${new Date().toISOString().slice(0, 10)}.xlsx`);
            };

            const getRiskColor = (r) => ({ 'ë†’ìŒ': 'bg-red-100 text-red-700', 'ì£¼ì˜': 'bg-orange-100 text-orange-700', 'ë‚®ìŒ': 'bg-green-100 text-green-700' }[r] || 'bg-gray-100');
            const activeFilterCount = Object.values(filters).filter(Boolean).length;

            return (
                <div className="min-h-screen bg-slate-100">
                    {/* í—¤ë” */}
                    <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-4 sticky top-0 z-50 shadow-lg">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-lg font-bold">ğŸ“Š EDI ë°œì£¼ ë¶„ì„</h1>
                                <p className="text-blue-200 text-xs">{filteredData.length} / {data.length}ê±´ {activeFilterCount > 0 && `(í•„í„° ${activeFilterCount}ê°œ)`}</p>
                            </div>
                            <button onClick={() => setShowSettings(!showSettings)} className="p-2 bg-blue-700 rounded-lg hover:bg-blue-600">âš™ï¸</button>
                        </div>
                    </div>

                    {/* ì„¤ì • íŒ¨ë„ */}
                    {showSettings && (
                        <div className="bg-white border-b shadow-sm p-4">
                            <h3 className="font-bold text-sm mb-3">âš™ï¸ ì„¤ì •</h3>
                            <div className="mb-4">
                                <label className="block text-xs text-slate-600 mb-1">ğŸ“ ê¸°ë³¸ íŒŒì¼ ê²½ë¡œ (ë©”ëª¨ìš©)</label>
                                <input type="text" value={savedPath} onChange={(e) => saveDefaultPath(e.target.value)} placeholder="ì˜ˆ: C:\Users\ì‚¬ìš©ì\íšŒì‚¬ëª…\íŒë§¤íŒ€\EDIíŒŒì¼" className="w-full px-3 py-2 border rounded-lg text-sm" />
                            </div>
                            <div className="mb-4">
                                <label className="text-xs text-slate-600">ğŸ“„ ìµœê·¼ íŒŒì¼</label>
                                {recentFiles.length === 0 ? (
                                    <p className="text-xs text-slate-400 mt-1">ìµœê·¼ ì—…ë¡œë“œí•œ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                ) : (
                                    <div className="space-y-1 mt-1">
                                        {recentFiles.map((file, i) => (
                                            <div key={i} className="flex justify-between bg-slate-50 p-2 rounded text-xs">
                                                <span className="truncate flex-1">{file.name}</span>
                                                <span className="text-slate-400 ml-2">{file.count}ê±´</span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            <button onClick={() => setShowSettings(false)} className="w-full py-2 bg-slate-200 rounded-lg text-sm">ë‹«ê¸°</button>
                        </div>
                    )}

                    <div className="p-3 space-y-3 pb-20">
                        {/* ì €ì¥ëœ ê²½ë¡œ í‘œì‹œ */}
                        {savedPath && (
                            <div className="bg-blue-50 border border-blue-200 rounded-xl p-3">
                                <p className="text-xs text-blue-700">ğŸ“ <strong>íŒŒì¼ ìœ„ì¹˜:</strong> {savedPath}</p>
                            </div>
                        )}

                        {/* ì—…ë¡œë“œ */}
                        <div className="bg-white rounded-xl p-3 shadow-sm">
                            <div className="flex gap-2 flex-wrap">
                                <label className="flex-1 min-w-28 px-4 py-3 bg-blue-600 text-white rounded-xl text-center cursor-pointer text-sm font-medium">
                                    ğŸ“‚ Excel ì—…ë¡œë“œ
                                    <input type="file" accept=".xlsx,.xls" onChange={handleFileUpload} className="hidden" />
                                </label>
                                <button onClick={loadSample} className="flex-1 min-w-28 px-4 py-3 bg-amber-500 text-white rounded-xl text-sm font-medium">ğŸ“Š ìƒ˜í”Œ</button>
                            </div>
                            {isLoading && <p className="mt-2 text-xs text-center text-blue-600">â³ ë¡œë”© ì¤‘...</p>}
                            {uploadStatus && <p className={`mt-2 text-xs text-center ${uploadStatus.type === 'success' ? 'text-green-600' : 'text-red-600'}`}>{uploadStatus.type === 'success' ? 'âœ…' : 'âŒ'} {uploadStatus.message}</p>}
                        </div>

                        {/* í•„í„° í† ê¸€ */}
                        <button onClick={() => setShowFilters(!showFilters)} className="w-full bg-white rounded-xl p-3 shadow-sm flex justify-between items-center">
                            <span className="text-sm font-medium">ğŸ” ê³„ë‹¨ì‹ í•„í„° {activeFilterCount > 0 && <span className="bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded-full ml-2">{activeFilterCount}ê°œ</span>}</span>
                            <span>{showFilters ? 'â–²' : 'â–¼'}</span>
                        </button>

                        {/* í•„í„° íŒ¨ë„ */}
                        {showFilters && (
                            <div className="bg-white rounded-xl p-3 shadow-sm space-y-3">
                                {/* ê¸°ê°„ í•„í„° */}
                                <div>
                                    <label className="block text-xs font-medium text-slate-600 mb-1">ğŸ“… ì¡°íšŒ ê¸°ê°„</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        <select value={filters.ì‹œì‘ì›”} onChange={e => handleFilterChange('ì‹œì‘ì›”', e.target.value)} className="px-3 py-2 border rounded-lg text-sm">
                                            <option value="">ì‹œì‘ì›”</option>
                                            {ì›”Options.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select>
                                        <select value={filters.ì¢…ë£Œì›”} onChange={e => handleFilterChange('ì¢…ë£Œì›”', e.target.value)} className="px-3 py-2 border rounded-lg text-sm">
                                            <option value="">ì¢…ë£Œì›”</option>
                                            {ì›”Options.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select>
                                    </div>
                                </div>

                                {/* ì§€ì—­ â†’ ê³ ê°ì‚¬ */}
                                <div className="grid grid-cols-2 gap-2">
                                    <div>
                                        <label className="block text-xs font-medium text-slate-600 mb-1">â‘  ì§€ì—­ ({ì§€ì—­Options.length})</label>
                                        <select value={filters.ì§€ì—­} onChange={e => handleFilterChange('ì§€ì—­', e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm">
                                            <option value="">ì „ì²´</option>
                                            {ì§€ì—­Options.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-medium text-slate-600 mb-1">â‘¡ ê³ ê°ì‚¬ ({ê³ ê°ì‚¬Options.length})</label>
                                        <select value={filters.ê³ ê°ì‚¬} onChange={e => handleFilterChange('ê³ ê°ì‚¬', e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm">
                                            <option value="">ì „ì²´</option>
                                            {ê³ ê°ì‚¬Options.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select>
                                    </div>
                                </div>

                                {/* ì°¨ì¢… â†’ í’ˆë²ˆ */}
                                <div className="grid grid-cols-2 gap-2">
                                    <div>
                                        <label className="block text-xs font-medium text-slate-600 mb-1">â‘¢ ì°¨ì¢… ({ì°¨ì¢…Options.length})</label>
                                        <select value={filters.ì°¨ì¢…} onChange={e => handleFilterChange('ì°¨ì¢…', e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm">
                                            <option value="">ì „ì²´</option>
                                            {ì°¨ì¢…Options.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-xs font-medium text-slate-600 mb-1">â‘£ í’ˆë²ˆ ({í’ˆë²ˆOptions.length})</label>
                                        <select value={filters.í’ˆë²ˆ} onChange={e => handleFilterChange('í’ˆë²ˆ', e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm">
                                            <option value="">ì „ì²´</option>
                                            {í’ˆë²ˆOptions.map(o => <option key={o} value={o}>{o}</option>)}
                                        </select>
                                    </div>
                                </div>

                                {/* í’ˆëª… */}
                                <div>
                                    <label className="block text-xs font-medium text-slate-600 mb-1">â‘¤ í’ˆëª… ({í’ˆëª…Options.length})</label>
                                    <select value={filters.í’ˆëª…} onChange={e => handleFilterChange('í’ˆëª…', e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm">
                                        <option value="">ì „ì²´</option>
                                        {í’ˆëª…Options.map(o => <option key={o} value={o}>{o.length > 30 ? o.slice(0, 30) + '...' : o}</option>)}
                                    </select>
                                </div>

                                {/* í•„í„° ì´ˆê¸°í™” */}
                                <button onClick={resetFilters} className="w-full py-2 bg-slate-100 text-slate-600 rounded-lg text-xs">ğŸ”„ í•„í„° ì´ˆê¸°í™”</button>
                            </div>
                        )}

                        {/* KPI */}
                        <div className="grid grid-cols-2 gap-2">
                            <div className="bg-white rounded-xl p-3 shadow-sm text-center">
                                <p className="text-xs text-slate-500">ğŸ“¦ ê³„íš</p>
                                <p className="text-lg font-bold text-blue-600">{kpis.plan.toLocaleString()}</p>
                            </div>
                            <div className="bg-white rounded-xl p-3 shadow-sm text-center">
                                <p className="text-xs text-slate-500">ğŸ“¦ ì‹¤ì œ</p>
                                <p className="text-lg font-bold text-green-600">{kpis.actual.toLocaleString()}</p>
                            </div>
                            <div className="bg-white rounded-xl p-3 shadow-sm text-center">
                                <p className="text-xs text-slate-500">ğŸ“ˆ ë³€ë™ìœ¨</p>
                                <p className={`text-lg font-bold ${kpis.avgVar >= 0 ? 'text-emerald-600' : 'text-red-600'}`}>{kpis.avgVar > 0 ? '+' : ''}{kpis.avgVar}%</p>
                            </div>
                            <div className="bg-white rounded-xl p-3 shadow-sm text-center">
                                <p className="text-xs text-slate-500">ğŸ“Š ì¶œê³ ìœ¨</p>
                                <p className={`text-lg font-bold ${kpis.avgRate >= 100 ? 'text-emerald-600' : 'text-amber-600'}`}>{kpis.avgRate}%</p>
                            </div>
                        </div>

                        {/* íƒ­ */}
                        <div className="flex gap-2">
                            <button onClick={() => setActiveTab('analysis')} className={`flex-1 py-2 rounded-lg text-sm font-medium ${activeTab === 'analysis' ? 'bg-blue-600 text-white' : 'bg-white'}`}>ğŸ“Š ë¶„ì„</button>
                            <button onClick={() => setActiveTab('recommend')} className={`flex-1 py-2 rounded-lg text-sm font-medium ${activeTab === 'recommend' ? 'bg-amber-500 text-white' : 'bg-white'}`}>ğŸ’¡ ì œì•ˆ ({recommendations.length})</button>
                        </div>

                        {/* ë°ì´í„° */}
                        {activeTab === 'analysis' ? (
                            <div className="space-y-2">
                                {filteredData.length === 0 ? (
                                    <div className="bg-white rounded-xl p-8 text-center text-slate-400">ğŸ“‚ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì„¸ìš”</div>
                                ) : filteredData.slice(0, 100).map((r, i) => (
                                    <div key={i} className="bg-white rounded-xl p-3 shadow-sm">
                                        <div className="flex justify-between items-start mb-2">
                                            <div className="flex items-center gap-1 flex-wrap">
                                                <span className={`px-2 py-0.5 rounded text-xs ${r.ì§€ì—­ === 'US' ? 'bg-blue-100 text-blue-700' : r.ì§€ì—­ === 'MX' ? 'bg-green-100 text-green-700' : r.ì§€ì—­ === 'CA' ? 'bg-red-100 text-red-700' : 'bg-purple-100 text-purple-700'}`}>{r.ì§€ì—­}</span>
                                                <span className="text-sm font-medium">{r.ê³ ê°ì‚¬}</span>
                                                {r.ì°¨ì¢… && <span className="px-1.5 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">{r.ì°¨ì¢…}</span>}
                                            </div>
                                            <span className={`px-2 py-0.5 rounded text-xs font-medium ${r.ì¶œê³ ìœ¨ >= 100 ? 'bg-emerald-100 text-emerald-700' : r.ì¶œê³ ìœ¨ >= 80 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'}`}>{r.ì¶œê³ ìœ¨}%</span>
                                        </div>
                                        <p className="text-xs text-slate-500 mb-1">{r.í’ˆë²ˆ} | {r.í’ˆëª…}</p>
                                        <p className="text-xs text-slate-400 mb-1">{r.ë¶„ì„ì›”}</p>
                                        <div className="flex justify-between text-sm">
                                            <span>ê³„íš: <strong>{r.ê³„íšë°œì£¼ìˆ˜ëŸ‰.toLocaleString()}</strong></span>
                                            <span>ì‹¤ì œ: <strong>{r.ì‹¤ì œë°œì£¼ìˆ˜ëŸ‰.toLocaleString()}</strong></span>
                                            <span className={r.ë³€ë™ìœ¨ >= 0 ? 'text-emerald-600' : 'text-red-600'}>{r.ë³€ë™ìœ¨ > 0 ? '+' : ''}{r.ë³€ë™ìœ¨}%</span>
                                        </div>
                                    </div>
                                ))}
                                {filteredData.length > 100 && <p className="text-center text-xs text-slate-400">... ì™¸ {filteredData.length - 100}ê±´</p>}
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {recommendations.length === 0 ? (
                                    <div className="bg-white rounded-xl p-8 text-center text-slate-400">ğŸ“‚ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ì„¸ìš”</div>
                                ) : recommendations.slice(0, 50).map((r, i) => (
                                    <div key={i} className="bg-white rounded-xl p-3 shadow-sm">
                                        <div className="flex justify-between items-start mb-2">
                                            <div className="flex items-center gap-1 flex-wrap">
                                                <span className={`px-2 py-0.5 rounded text-xs ${r.ì§€ì—­ === 'US' ? 'bg-blue-100 text-blue-700' : r.ì§€ì—­ === 'MX' ? 'bg-green-100 text-green-700' : r.ì§€ì—­ === 'CA' ? 'bg-red-100 text-red-700' : 'bg-purple-100 text-purple-700'}`}>{r.ì§€ì—­}</span>
                                                <span className="text-sm font-medium">{r.ê³ ê°ì‚¬}</span>
                                                {r.ì°¨ì¢… && <span className="px-1.5 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">{r.ì°¨ì¢…}</span>}
                                            </div>
                                            <span className={`px-2 py-0.5 rounded text-xs font-medium ${getRiskColor(r.ìœ„í—˜ë“±ê¸‰)}`}>{r.ìœ„í—˜ë“±ê¸‰}</span>
                                        </div>
                                        <p className="text-xs text-slate-500 mb-2">{r.í’ˆë²ˆ} | {r.í’ˆëª…}</p>
                                        <div className="flex justify-between items-center">
                                            <div className="text-sm">
                                                ì¶œê³ ìœ¨: <strong className={r.í‰ê· ì¶œê³ ìœ¨ >= 100 ? 'text-emerald-600' : 'text-amber-600'}>{r.í‰ê· ì¶œê³ ìœ¨}%</strong>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-xs text-slate-500">ê¶Œì¥ìˆ˜ëŸ‰</p>
                                                <p className="text-lg font-bold text-blue-600">{r.ê¶Œì¥ìˆ˜ëŸ‰.toLocaleString()}</p>
                                            </div>
                                        </div>
                                        <div className="mt-2 bg-slate-100 rounded-full h-1.5">
                                            <div className="bg-blue-500 h-1.5 rounded-full" style={{width: `${r.ì‹ ë¢°ë„}%`}}></div>
                                        </div>
                                        <p className="text-xs text-slate-400 mt-1 text-right">ì‹ ë¢°ë„ {r.ì‹ ë¢°ë„}%</p>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* í•˜ë‹¨ ë²„íŠ¼ */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t p-3 flex gap-2">
                        <button onClick={downloadExcel} disabled={filteredData.length === 0} className="flex-1 py-3 bg-green-600 text-white rounded-xl font-medium disabled:bg-slate-300">ğŸ“¥ Excel ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<EDIDashboard />);
    </script>
</body>
</html>
